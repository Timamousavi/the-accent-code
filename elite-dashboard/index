<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Accent Code - Course Dashboard</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/C5TztqGd/Bag-Logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Source+Sans+3:wght@400;600&display=swap');
        body {
            font-family: 'Source Sans 3', sans-serif;
            background-color: #0A0A0A;
            background-image: url('https://i.ibb.co/FLqLTQNJ/KDream-Cast-EP02-ALI-MOBINI-You-Tube-Thumbnail-5.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: #F0F0F0;
        }
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
        }
        .bg-custom-gradient {
            background: linear-gradient(145deg, #1A1A1A, #0a2540);
        }
        .text-accent {
            color: #00A9A5; /* A vibrant teal for a premium feel */
        }
        .bg-accent {
            background-color: #00A9A5;
        }
        .border-custom {
            border-color: #333;
        }
        .shadow-custom {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
        }
        .hover\:bg-teal-400:hover {
            background-color: #008f8a;
        }
        .button-glow {
            animation: pulse-glow 2s infinite;
        }
        .tag-glow {
            animation: text-pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 5px #00A9A5; }
            50% { box-shadow: 0 0 20px #00A9A5, 0 0 30px #00A9A5; }
            100% { box-shadow: 0 0 5px #00A9A5; }
        }
        @keyframes text-pulse-glow {
            0% { text-shadow: 0 0 5px #00A9A5; }
            50% { text-shadow: 0 0 20px #00A9A5, 0 0 30px #00A9A5; }
            100% { text-shadow: 0 0 5px #00A9A5; }
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            border-bottom: 3px solid #00A9A5;
            color: #00A9A5;
            font-weight: bold;
        }
        .module-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .module-content.open {
            max-height: 2000px;
        }
        .chat-message {
            max-width: 80%;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }
        .chat-message.user {
            background-color: #2D3748;
            align-self: flex-end;
            margin-left: auto;
        }
        .chat-message.ai {
            background-color: #1A202C;
            border: 1px solid #00A9A5;
            align-self: flex-start;
            margin-right: auto;
        }
        .loading-dot {
            animation: blink 1.4s infinite ease-in-out;
            animation-fill-mode: both;
        }
        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .link-icon {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            fill: #00A9A5;
        }
        .module-locked {
            filter: grayscale(100%);
            pointer-events: none;
            opacity: 0.4;
        }
        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 250px;
            padding: 24px;
            background-color: #0A0A0A;
            border-left: 1px solid #333;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 70;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        #calendly-iframe {
            min-width: 320px;
            height: 700px;
        }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen">
    <!-- Fixed Header -->
    <header class="fixed top-0 left-0 w-full z-[60] bg-slate-900 py-4 px-6 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <img src="https://i.ibb.co/C5TztqGd/Bag-Logo.png" alt="Bag-Logo" class="h-12 w-auto">
            <div class="flex flex-col">
                <h1 class="text-3xl font-bold">Course Dashboard</h1>
                <p class="text-sm text-slate-400 mt-1">Welcome back, <span id="userNameDisplay">student</span>!</p>
            </div>
        </div>
        <button id="menu-toggle-btn" class="text-white hover:text-accent transition-colors duration-200">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
        </button>
    </header>

    <!-- Main Content Area Wrapper -->
    <div class="flex-grow flex flex-col md:flex-row max-w-6xl mx-auto px-6 relative z-10 pt-24">

        <main class="flex-grow">
            <!-- Tab Navigation -->
            <div class="flex justify-center border-b border-slate-700 mb-8 mt-4">
                <button id="modules-tab" class="tab-button active py-4 px-6 text-lg">Course Modules</button>
                <button id="tools-tab" class="tab-button py-4 px-6 text-lg">AI Tools</button>
            </div>
            
            <!-- Student Profile Section -->
            <section id="profile-section" class="py-4 hidden">
                <h2 class="text-2xl font-bold text-accent mb-4">Student Profile</h2>
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom">
                    <p class="text-slate-400">This is where your personal information will be displayed.</p>
                </div>
            </section>

            <!-- Payment Details Section -->
            <section id="payment-section" class="py-4 hidden">
                <h2 class="text-2xl font-bold text-accent mb-4">Payment Details</h2>
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom">
                    <p class="text-slate-400">Manage your subscription and view payment history here.</p>
                </div>
            </section>

            <!-- Support Section -->
            <section id="support-section" class="py-4 hidden">
                <h2 class="text-2xl font-bold text-accent mb-4">Support</h2>
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom">
                    <p class="text-slate-400">For any questions or issues, please contact our support team at <a href="mailto:theaccentcode@outlook.com" class="text-accent hover:underline">theaccentcode@outlook.com</a>.</p>
                </div>
            </section>

            <!-- Workbooks & Guides Document Section -->
            <section id="workbooks-guides-section" class="py-4 hidden">
                <button onclick="showSection('modules-section', 'modules-tab')" class="mb-4 text-accent hover:text-white transition-colors duration-200">
                    &larr; Back to Dashboard
                </button>
                <div id="workbooks-content-display" class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom"></div>
            </section>

            <!-- Calendly Booking Section -->
            <section id="book-call-section" class="py-4 hidden">
                <button onclick="showSection('modules-section', 'modules-tab')" class="mb-4 text-accent hover:text-white transition-colors duration-200">
                    &larr; Back to Dashboard
                </button>
                <h2 class="text-2xl font-bold text-accent mb-4">Book Your Personalized Coaching Call</h2>
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom">
                    <p class="text-slate-400 mb-4">Use the calendar below to book your 1-on-1 coaching call with Tima.</p>
                    <div class="overflow-hidden rounded-lg">
                        <iframe id="calendly-iframe" src="https://calendly.com/theaccentcode/30min" frameborder="0" style="width: 100%; min-width: 320px; height: 700px;"></iframe>
                    </div>
                </div>
            </section>
            
            <!-- Elite Student Section -->
            <section id="elite-section" class="py-4 hidden">
                <button onclick="showSection('modules-section', 'modules-tab')" class="mb-4 text-accent hover:text-white transition-colors duration-200">
                    &larr; Back to Dashboard
                </button>
                <h2 class="text-2xl font-bold text-accent mb-4">Your Personalized Elite Program</h2>
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom">
                    <p class="text-slate-400 mb-4">This is where you can access your personalized practice plan and upload your diagnostic recordings for feedback.</p>
                    <div class="mt-4">
                        <div class="flex justify-between items-center bg-slate-800 p-4 rounded-lg border border-custom">
                            <h4 class="text-lg font-bold text-white">My Personalized Plan</h4>
                            <a href="#" class="text-accent hover:text-white transition-colors duration-200">View &rarr;</a>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between items-center bg-slate-800 p-4 rounded-lg border border-custom">
                            <h4 class="text-lg font-bold text-white">Upload Diagnostic Recording</h4>
                            <a href="#" class="text-accent hover:text-white transition-colors duration-200">Upload &rarr;</a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Course Modules Section -->
            <section id="modules-section" class="py-4">
                <h2 class="text-2xl font-bold text-accent mb-4">Program Details <span class="text-xl text-accent font-bold tag-glow">| ELITE STUDENT</span></h2>
                <div class="grid grid-cols-1 gap-6">

                    <!-- Module 1 -->
                    <div id="module1" class="module bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom cursor-pointer" onclick="toggleModule('module1')">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm font-semibold text-accent">Module 1 • Week 1</div>
                                <div class="mt-2 text-xl font-bold">The Neuroscience of a New Accent</div>
                            </div>
                            <svg class="w-6 h-6 transform transition-transform duration-300" id="arrow-module1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div id="module1-content" class="module-content">
                            <p class="text-slate-400 mt-4"><strong>Goal:</strong> Establish a growth mindset by understanding the science of learning, and set a clear, measurable baseline.</p>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 1: Unlocking Your Brain's Potential for a New Accent</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Introduces Neuroplasticity in the adult brain. Explain that accent modification is not about overcoming a fixed limitation but about forming new neural pathways. 
                                <p class="text-slate-400 mt-2"><strong>Snippet:</strong> "Your accent is a deeply ingrained habit, a superhighway in your brain. We aren't trying to destroy that highway; we're building a new, parallel one. With consistent, targeted practice, your brain will start preferring the new route for American English."</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 2: The Three Stages of Motor Skill Learning</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Frame accent acquisition using the Fitts & Posner three-stage model of motor learning: Cognitive Stage, Associative Stage, and Autonomous Stage.
                                <p class="text-slate-400 mt-2"><strong>Outcome:</strong> Students see a clear roadmap of how they will learn and understand that initial awkwardness is a normal part of the process.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 3: Your Personalized Roadmap & The Power of Listening</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Introduce the concept of Interlanguage and the importance of Active, Analytical Listening.</p>
                                <p class="text-slate-400 mt-2"><strong>Outcome:</strong> Students learn to diagnose their own speech patterns by comparing their diagnostic recording to a native speaker's version. They create a "target sounds" list.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            <button id="complete-module1-btn" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200" onclick="markComplete('module1')">Mark Module 1 as Complete</button>
                        </div>
                    </div>

                    <!-- Module 2 -->
                    <div id="module2" class="module bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom cursor-pointer module-locked" onclick="toggleModule('module2')">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm font-semibold text-accent">Module 2 • Weeks 2-3</div>
                                <div class="mt-2 text-xl font-bold">The Building Blocks - American English Phonetics</div>
                            </div>
                            <svg class="w-6 h-6 transform transition-transform duration-300" id="arrow-module2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div id="module2-content" class="module-content">
                            <p class="text-slate-400 mt-4"><strong>Goal:</strong> Master the production of individual American English sounds (phonemes) using a phonetic approach.</p>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 1: Your New Toolkit: The International Phonetic Alphabet (IPA)</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Introduce the IPA as a scientific tool to "see" sounds, bypassing the confusion of English spelling. Focus only on the symbols relevant to General American English.</p>
                                <p class="text-slate-400 mt-2"><strong>Snippet:</strong> "English spelling is not your friend. The letters 'ough' can be pronounced in at least seven different ways. The IPA is our cheat code. One symbol equals one sound. Always."</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 2: Mastering American Vowels - The Mouth Map</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Teach vowels based on tongue position (height: high/mid/low; backness: front/central/back) and lip rounding. Cover tense vs. lax vowels.</p>
                                <p class="text-slate-400 mt-2"><strong>Drills:</strong> Minimal pair drills for each vowel pair (e.g., sheet/shit, pool/pull).</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 3: Vowel Deep Dive 2: The Wide /æ/ vs. The Relaxed /ɛ/ (bat vs. bet)</h5>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 4: The Key Consonants: Voicing, Place & Airflow</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Explain consonants based on place of articulation, manner of articulation, and voicing.
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 5: The "Big Three" American Sounds: The 'R', The Flap 'T', and The Dark 'L'</h5>
                                <p class="text-slate-400 mt-2"><strong>Outcome:</strong> Target the most characteristic and often difficult sounds of the American accent.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            <button id="complete-module2-btn" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200" onclick="markComplete('module2')">Mark Module 2 as Complete</button>
                        </div>
                    </div>

                    <!-- Module 3 -->
                    <div id="module3" class="module bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom cursor-pointer module-locked" onclick="toggleModule('module3')">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm font-semibold text-accent">Module 3 • Week 4</div>
                                <div class="mt-2 text-xl font-bold">The Music of Speech - Prosody & Intonation</div>
                            </div>
                            <svg class="w-6 h-6 transform transition-transform duration-300" id="arrow-module3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div id="module3-content" class="module-content">
                            <p class="text-slate-400 mt-4"><strong>Goal:</strong> Move beyond individual sounds to master the rhythm, stress, and melody of American English.</p>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 1: The Rhythm Rule: Stressing Words & Syllables</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Explain that English is a stress-timed language, unlike many other syllable-timed languages. This is the single biggest key to sounding natural.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 2: The Power of Pitch: Intonation & Focus Words</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Introduce intonation contours (rising for Y/N questions, falling for statements) and the concept of a focus word (the most important word in a phrase that receives the highest pitch).</p>
                                <p class="text-slate-400 mt-2"><strong>Snippet:</strong> "The sentence 'She DRIVES the car' means something different from 'SHE drives the car.' The melody carries the meaning."</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 3: Thought Groups & Chunking</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Explain how native speakers group words into "thought groups" or chunks, pausing briefly between them. This improves listener comprehension and makes the speaker sound more fluent.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            <button id="complete-module3-btn" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200" onclick="markComplete('module3')">Mark Module 3 as Complete</button>
                        </div>
                    </div>

                    <!-- Module 4 -->
                    <div id="module4" class="module bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom cursor-pointer module-locked" onclick="toggleModule('module4')">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm font-semibold text-accent">Module 4 • Week 5</div>
                                <div class="mt-2 text-xl font-bold">Connected Speech - The Secrets of Natural Flow</div>
                            </div>
                            <svg class="w-6 h-6 transform transition-transform duration-300" id="arrow-module4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div id="module4-content" class="module-content">
                            <p class="text-slate-400 mt-4"><strong>Goal:</strong> Understand and produce the "shortcuts" native speakers use that are never taught in traditional classes.</p>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 1: Linking Words Together (Liaison)</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Teach rules for linking: Consonant-to-Vowel (an_apple), Vowel-to-Vowel (go_away), and Consonant-to-Consonant.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 2: Reductions & Vanishing Sounds</h5>
                                <p class="text-slate-400 mt-2"><strong>Science:</strong> Introduce common reductions (e.g., want to -> wanna, going to -> gonna) and elision (dropping sounds, e.g., I don't know -> I dunno).</p>
                                <p class="text-400 mt-2"><strong>Outcome:</strong> Students stop over-enunciating and learn the real rhythm of casual speech.</p>
                                <p class="text-400 mt-2"><strong>Snippet:</strong> "No one says 'I am going to go to the store.' They say, 'I'm gonna go tə the store.' Learning these reductions is essential for both understanding and sounding natural."</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            <button id="complete-module4-btn" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200" onclick="markComplete('module4')">Mark Module 4 as Complete</button>
                        </div>
                    </div>

                    <!-- Module 5 -->
                    <div id="module5" class="module bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom cursor-pointer module-locked" onclick="toggleModule('module5')">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm font-semibold text-accent">Module 5 • Weeks 6-7</div>
                                <div class="mt-2 text-xl font-bold">Active Training & Integration</div>
                            </div>
                            <svg class="w-6 h-6 transform transition-transform duration-300" id="arrow-module5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div id="module5-content" class="module-content">
                            <p class="text-slate-400 mt-4"><strong>Goal:</strong> Integrate all learned skills (phonemes, prosody, connected speech) through advanced, active practice.</p>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 1: Introduction to Scientific Shadowing</h5>
                                <p class="text-slate-400 mt-2"><strong>Outcome:</strong> Students learn to use shadowing not just as mimicry, but as an analytical tool.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 2: Shadowing for Prosody</h5>
                                <p class="text-slate-400 mt-2"><strong>Activity:</strong> Shadow speakers with clear intonation (e.g., news anchors, TED Talk presenters). Students focus only on matching the rhythm and melody, not perfect words.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 3: Shadowing for Flow & Reductions</h5>
                                <p class="text-slate-400 mt-2"><strong>Activity:</strong> Shadow conversational speech from sitcoms or podcasts. The goal is to capture the linking and reductions.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 4: Self-Analysis & The Feedback Loop</h5>
                                <p class="text-slate-400 mt-2"><strong>Action Item:</strong> Students re-record the same paragraph from the pre-course diagnostic. They listen to their Day 1 and Final Day recordings side-by-side.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            <button id="complete-module5-btn" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200" onclick="markComplete('module5')">Mark Module 5 as Complete</button>
                        </div>
                    </div>

                    <!-- Module 6 -->
                    <div id="module6" class="module bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom cursor-pointer module-locked" onclick="toggleModule('module6')">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="text-sm font-semibold text-accent">Module 6 • Week 8</div>
                                <div class="mt-2 text-xl font-bold">Real-World Application & Lifelong Practice</div>
                            </div>
                            <svg class="w-6 h-6 transform transition-transform duration-300" id="arrow-module6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                        <div id="module6-content" class="module-content">
                            <p class="text-slate-400 mt-4"><strong>Goal:</strong> Transition from structured practice to confident use in daily life and establish habits for continuous improvement.</p>
                            
                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 1: From Practice to Performance: Low-Stakes Conversations</h5>
                                <p class="text-slate-400 mt-2"><strong>Strategy:</strong> Provide strategies for using the new accent in low-stakes situations (e.g., ordering coffee, asking for directions) to build confidence before high-stakes meetings.</p>
                                <p class="text-slate-400 mt-2"><strong>Snippet:</strong> "Every time you speak, it's a chance to practice one thing. This week, just focus on using the Flap 'T' correctly. Next week, focus on falling intonation at the end of your statements. One skill at a time."</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 2: Creating Your Accent Maintenance Plan</h5>
                                <p class="text-slate-400 mt-2"><strong>Outcome:</strong> Students create a sustainable, 10-minute daily routine.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Lesson 3: The Final Benchmark & Your Transformation</h5>
                                <p class="text-slate-400 mt-2"><strong>Action Item:</strong> Students re-record the same paragraph from the pre-course diagnostic. They listen to their Day 1 and Final Day recordings side-by-side.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h5 class="text-lg font-bold text-accent">Bonus Lesson: Resources for Continued Growth</h5>
                                <p class="text-slate-400 mt-2">Links to recommended podcasts, YouTube channels, apps (e.g., Anki for flashcards), and tools for continued learning.</p>
                                <div class="mt-4 rounded-lg shadow-custom">
                                    <iframe width="100%" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg"></iframe>
                                </div>
                            </div>
                            <button id="complete-module6-btn" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200" onclick="markComplete('module6')">Mark Module 6 as Complete</button>
                        </div>
                    </div>

                    <!-- Workbooks & Guides Section -->
                    <div class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom">
                        <h4 class="text-2xl font-bold text-accent">Course Workbooks & Guides</h4>
                        <p class="text-slate-400 mt-2">Download these essential resources to supplement your video lessons.</p>
                        <a href="#" onclick="showWorkbooks()" class="mt-4 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200 shadow-custom">
                            View All Workbooks & Guides
                        </a>
                    </div>
                </div>
            </section>

            <!-- AI Tools Section -->
            <section id="tools-section" class="py-4 hidden">
                <h2 class="text-2xl font-bold text-accent mb-4">AI Tools</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- AI Pronunciation Coach -->
                    <div class="bg-custom-gradient p-6 rounded-xl shadow-custom flex flex-col h-full card-hidden">
                        <h4 class="text-2xl font-bold text-accent mb-4">Phonex</h4>
                        <div id="chat-container" class="flex flex-col flex-grow overflow-y-auto mb-4 p-4 border border-custom rounded-lg bg-slate-800" style="max-height: 500px;">
                            <!-- Chat messages will be appended here -->
                            <div class="chat-message ai">Hello! I'm Phonex, your personal AI pronunciation coach. How can I help you today?</div>
                        </div>
                        <div class="flex gap-2 mt-4">
                            <input type="text" id="coach-input" class="flex-grow bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Ask a question about your accent training..." />
                            <button id="send-btn" class="rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200">Send</button>
                        </div>
                        <div id="api-status-coach" class="text-sm text-slate-400 mt-2 text-center hidden">Connecting to AI...</div>
                    </div>

                    <!-- Text-to-Speech Tool -->
                    <div class="bg-custom-gradient p-6 rounded-xl shadow-custom flex flex-col h-full card-hidden">
                        <h4 class="text-2xl font-bold text-accent mb-4">Text-to-Speech Tool</h4>
                        <textarea id="tts-input" class="w-full h-40 bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Type or paste text to hear it..."></textarea>
                        <select id="voice-select" class="w-full bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent mt-4">
                            <option value="Kore">Kore (Firm)</option>
                            <option value="Puck">Puck (Upbeat)</option>
                            <option value="Zephyr">Zephyr (Bright)</option>
                            <option value="Algieba">Algieba (Smooth)</option>
                        </select>
                        <button id="tts-btn" class="w-full rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200 mt-4">Hear Text</button>
                        <audio id="tts-audio" class="w-full mt-4 rounded-lg hidden"></audio>
                        <div id="api-status-tts" class="text-sm text-slate-400 mt-2 text-center hidden">Generating audio...</div>
                    </div>
                </div>
            </section>
            
            <!-- Upgrade Section -->
            <section id="upgrade-section" class="py-12">
                <div class="bg-custom-gradient rounded-xl p-8 shadow-custom border border-custom flex flex-col items-center text-center">
                    <h2 class="text-3xl font-bold text-white">Ready for more?</h2>
                    <ul class="text-slate-400 mt-4 mb-6 space-y-2 text-lg text-left">
                        <li class="flex items-center gap-2"><svg class="w-6 h-6 flex-shrink-0 text-accent" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>4x 1-on-1 personalized coaching calls</span></li>
                        <li class="flex items-center gap-2"><svg class="w-6 h-6 flex-shrink-0 text-accent" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Personalized feedback on your diagnostic recordings</span></li>
                        <li class="flex items-center gap-2"><svg class="w-6 h-6 flex-shrink-0 text-accent" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg><span>Custom practice plans to target your specific challenges</span></li>
                    </ul>
                    <a href="#" onclick="showSection('book-call-section')" class="mt-6 w-full md:w-auto rounded-md px-8 py-4 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200 shadow-custom text-lg button-glow">
                        Book Your Elite Call
                    </a>
                </div>
            </section>
        </main>
    </div>

    <!-- Right-Side Fixed Navigation Sidebar -->
    <aside id="sidebar" class="sidebar hidden md:block">
        <div class="flex flex-col h-full">
            <!-- Close Button -->
            <div class="text-right">
                <button id="close-menu-btn" class="text-white hover:text-accent transition-colors duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <!-- Logo and User Info -->
            <div class="mb-8">
                <img src="https://i.ibb.co/C5TztqGd/Bag-Logo.png" alt="Bag-Logo" class="h-16 w-auto mx-auto mb-4">
                <p class="text-lg font-bold text-center text-accent">The Accent Code</p>
                <p class="text-sm text-center text-slate-400 mt-1">Welcome, student!</p>
                <div class="text-sm text-slate-500 text-center mt-2">User ID: <span id="userId">Loading...</span></div>
            </div>
            
            <!-- Navigation Links -->
            <nav class="flex-grow">
                <ul class="space-y-4">
                    <li><a href="#profile-section" onclick="showSection('profile-section'); closeSidebar();" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Student Profile</a></li>
                    <li><a href="#payment-section" onclick="showSection('payment-section'); closeSidebar();" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Payment Details</a></li>
                    <li><a href="#modules-section" onclick="showSection('modules-section'); closeSidebar();" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Program Details</a></li>
                    <li><a href="#progress-section" onclick="showSection('progress-section'); closeSidebar();" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Progress</a></li>
                    <li><a href="#book-call-section" onclick="showSection('book-call-section'); closeSidebar();" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Book an Elite Call</a></li>
                    <li><a href="#elite-section" onclick="showSection('elite-section'); closeSidebar();" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Elite Program</a></li>
                    <li><a href="#support-section" onclick="showSection('support-section'); closeSidebar();" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Support</a></li>
                    <li><a href="#" onclick="showWorkbooks()" class="flex items-center gap-3 text-white hover:text-accent transition-colors duration-200 font-medium">Workbooks & Guides</a></li>
                </ul>
            </nav>

            <!-- Progress Bar at the bottom of the sidebar -->
            <div id="progress-section" class="mt-auto pt-6">
                <h5 class="text-xl font-bold text-accent mb-2">Your Progress</h5>
                <div class="text-sm text-slate-400 mt-2">
                    <span id="progressText">0% Complete</span>
                </div>
                <div class="w-full h-2 bg-slate-700 rounded-full mt-2">
                    <div id="progressBar" class="h-full bg-accent rounded-full transition-all duration-500" style="width: 0%;"></div>
                </div>
                <div class="text-sm text-slate-400 mt-4">
                    <span id="currentModuleText">Module 1 of 6</span>
                </div>
            </div>
        </div>
    </aside>
    <footer class="border-t border-slate-700 bg-slate-900 py-8 text-center text-slate-400">
        <div class="font-bold text-white">The Accent Code</div>
        <div class="text-sm mt-1">Made with love by Tima Mousavi &copy; 2025 ❤️</div>
    </footer>

    <script id="workbook-content" type="text/javascript">
        const workbooksData = [
            { title: "Module 1 Workbook", description: "Essential exercises for Week 1." },
            { title: "Module 2 Workbook", description: "Essential exercises for Weeks 2-3." },
            { title: "Module 3 Workbook", description: "Essential exercises for Week 4." },
            { title: "Module 4 Workbook", description: "Essential exercises for Week 5." },
            { title: "Module 5 Workbook", description: "Essential exercises for Weeks 6-7." },
            { title: "Module 6 Workbook", description: "Essential exercises for Week 8." },
            { title: "The American English IPA Chart", description: "Your key to pronouncing sounds with precision." },
            { title: "Your Time Commitment Guide", description: "A guide to planning your study schedule." },
            { title: "The S.C.A.N. Method™ Guide", description: "An in-depth look at our signature method." },
            { title: "Connected Speech Cheat Sheet", description: "The essential guide to reductions and linking." },
            { title: "The Accent Code Course Handbook", description: "Your complete reference for the course." }
        ];

        function getWorkbooksHtml() {
            let html = `
                <div class="space-y-4">
                    <h2 class="text-3xl font-bold text-accent mb-4">Course Workbooks & Guides</h2>
                    <p class="text-slate-400 mb-6">Download these essential resources to supplement your video lessons.</p>
            `;
            workbooksData.forEach(item => {
                html += `
                    <div class="bg-slate-800 p-4 rounded-lg flex items-center gap-4 border border-custom shadow-lg">
                        <svg class="w-8 h-8 text-accent flex-shrink-0" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM8 20H6v-2h2v2zm0-4H6v-2h2v2zm4 4h-2v-2h2v2zm0-4h-2v-2h2v2zm4 4h-2v-2h2v2zm0-4h-2v-2h2v2zm4-4h-8V9h-8v3h16V8l-6-6z" />
                        </svg>
                        <div class="flex-grow">
                            <div class="text-lg font-bold text-white">${item.title}</div>
                            <p class="text-sm text-slate-400">${item.description}</p>
                        </div>
                        <a href="#" class="text-accent hover:text-white transition-colors duration-200">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                            </svg>
                        </a>
                    </div>
                `;
            });
            html += `</div>`;
            return html;
        }
    </script>
    <script>
        const API_KEY = ""; // Do not add a key here, it's provided by the canvas environment
        const CHAT_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + API_KEY;
        const TTS_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=" + API_KEY;
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 1000; // 1 second

        const chatHistory = [{ role: "model", parts: [{ text: "Hello! I'm Phonex, your personal AI pronunciation coach. How can I help you today?" }] }];

        // Helper function to convert base64 to ArrayBuffer
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        // Helper function to convert PCM audio to WAV blob
        function pcmToWav(pcmData, sampleRate) {
            const buffer = new ArrayBuffer(44 + pcmData.byteLength);
            const view = new DataView(buffer);
            let offset = 0;

            const writeString = (str) => {
                for (let i = 0; i < str.length; i++) {
                    view.setUint8(offset++, str.charCodeAt(i));
                }
            };

            const writeUint32 = (data) => {
                view.setUint32(offset, data, true);
                offset += 4;
            };

            const writeUint16 = (data) => {
                view.setUint16(offset, data, true);
                offset += 2;
            };

            // RIFF chunk
            writeString('RIFF');
            writeUint32(36 + pcmData.byteLength);
            writeString('WAVE');

            // fmt chunk
            writeString('fmt ');
            writeUint32(16);
            writeUint16(1); // Audio format (1 = PCM)
            writeUint16(1); // Number of channels
            writeUint32(sampleRate);
            writeUint32(sampleRate * 2); // Byte rate
            writeUint16(2); // Block align
            writeUint16(16); // Bits per sample

            // data chunk
            writeString('data');
            writeUint32(pcmData.byteLength);

            const pcm16 = new Int16Array(pcmData);
            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(offset, pcm16[i], true);
                offset += 2;
            }

            return new Blob([view], { type: 'audio/wav' });
        }
        
        // Tab switching logic
        document.getElementById('modules-tab').addEventListener('click', () => showSection('modules-section', 'modules-tab'));
        document.getElementById('tools-tab').addEventListener('click', () => showSection('tools-section', 'tools-tab'));
        
        // --- Sidebar Logic ---
        const sidebar = document.getElementById('sidebar');
        const menuToggleBtn = document.getElementById('menu-toggle-btn');
        const closeMenuBtn = document.getElementById('close-menu-btn');

        menuToggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });

        closeMenuBtn.addEventListener('click', () => {
            sidebar.classList.remove('open');
        });
        
        function closeSidebar() {
            sidebar.classList.remove('open');
        }

        function showSection(sectionId, tabId) {
            document.querySelectorAll('section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';

            if (tabId) {
                document.querySelectorAll('.tab-button').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
            }
        }
        
        function showWorkbooks() {
            const workbooksContentDisplay = document.getElementById('workbooks-content-display');
            showSection('workbooks-guides-section');
            closeSidebar();
            
            workbooksContentDisplay.innerHTML = getWorkbooksHtml();
        }

        // --- Module Progression Logic ---
        const totalModules = 6;
        let currentModule = 1;

        function updateModuleDisplay() {
            for (let i = 1; i <= totalModules; i++) {
                const module = document.getElementById(`module${i}`);
                const completeBtn = document.getElementById(`complete-module${i}-btn`);
                const isCompleted = i < currentModule;

                module.classList.toggle('module-locked', !isCompleted && i !== currentModule);
                
                if (completeBtn) {
                    completeBtn.style.display = (i === currentModule) ? 'block' : 'none';
                }
            }
            // Close all modules and open the current one
            document.querySelectorAll('.module-content.open').forEach(item => {
                item.classList.remove('open');
            });
            document.querySelectorAll('[id^="arrow-"]').forEach(item => {
                item.style.transform = 'rotate(0deg)';
            });
            updateProgressBar();
        }

        function toggleModule(moduleId) {
            const moduleIndex = parseInt(moduleId.replace('module', ''));
            if (moduleIndex > currentModule) {
                return; // Prevent opening locked modules
            }
            const content = document.getElementById(moduleId + '-content');
            const arrow = document.getElementById('arrow-' + moduleId);
            const isOpen = content.classList.contains('open');
            
            // Close all modules
            document.querySelectorAll('.module-content.open').forEach(item => {
                item.classList.remove('open');
            });
            document.querySelectorAll('[id^="arrow-"]').forEach(item => {
                item.style.transform = 'rotate(0deg)';
            });

            // Open the clicked module if it was not open
            if (!isOpen) {
                content.classList.add('open');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        function markComplete(moduleId) {
            const moduleIndex = parseInt(moduleId.replace('module', ''));
            if (moduleIndex < totalModules) {
                currentModule = moduleIndex + 1;
                localStorage.setItem('courseProgress', currentModule);
                
                updateModuleDisplay();
                
                // Automatically open the newly unlocked module
                toggleModule(`module${currentModule}`);
                
            } else {
                // All modules completed logic
            }
        }
        
        // --- Progress Bar Logic ---
        function updateProgressBar() {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const currentModuleText = document.getElementById('currentModuleText');

            const progressPercentage = (currentModule / totalModules) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `${progressPercentage.toFixed(0)}% Complete`;
            currentModuleText.textContent = `Module ${currentModule} of ${totalModules}`;
        }

        // AI Pronunciation Coach functionality
        const chatContainer = document.getElementById('chat-container');
        const coachInput = document.getElementById('coach-input');
        const sendBtn = document.getElementById('send-btn');
        const apiStatusCoach = document.getElementById('api-status-coach');

        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', isUser ? 'user' : 'ai');
            messageDiv.textContent = text;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            const userText = coachInput.value.trim();
            if (userText === '') return;
            addMessage(userText, true);
            coachInput.value = '';

            const loadingDots = document.createElement('div');
            loadingDots.id = 'loading-dots';
            loadingDots.innerHTML = `
                <div class="flex items-center space-x-1 p-3">
                    <span class="loading-dot w-2 h-2 rounded-full bg-accent"></span>
                    <span class="loading-dot w-2 h-2 rounded-full bg-accent"></span>
                    <span class="loading-dot w-2 h-2 rounded-full bg-accent"></span>
                </div>
            `;
            chatContainer.appendChild(loadingDots);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            apiStatusCoach.textContent = 'Thinking...';
            apiStatusCoach.classList.remove('hidden');

            const systemPrompt = "You are an expert AI pronunciation coach for a course called 'The Accent Code'. Your name is Phonex. Your role is to provide clear, helpful, and concise answers to student questions about American English pronunciation. You should be encouraging and focus on the principles taught in the course, such as phonetics, rhythm, intonation, and connected speech. Keep your responses friendly and professional.";
            const userQuery = userText;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            let retries = 0;
            while (retries < MAX_RETRIES) {
                try {
                    const response = await fetch(CHAT_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const aiResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (aiResponse) {
                        addMessage(aiResponse, false);
                    } else {
                        addMessage("Sorry, I couldn't process that. Please try again.", false);
                        console.error("API response was not as expected:", result);
                    }
                    apiStatusCoach.classList.add('hidden');
                    loadingDots.remove();
                    return;
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    retries++;
                    if (retries < MAX_RETRIES) {
                        await new Promise(res => setTimeout(res, RETRY_DELAY * Math.pow(2, retries - 1)));
                    } else {
                        apiStatusCoach.textContent = 'Failed to generate audio. Please try again.';
                        ttsBtn.disabled = false;
                    }
                }
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        coachInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Text-to-Speech functionality
        const ttsInput = document.getElementById('tts-input');
        const voiceSelect = document.getElementById('voice-select');
        const ttsBtn = document.getElementById('tts-btn');
        const ttsAudio = document.getElementById('tts-audio');
        const apiStatusTts = document.getElementById('api-status-tts');

        async function generateTTS() {
            const textToSpeak = ttsInput.value.trim();
            if (textToSpeak === '') {
                return;
            }

            apiStatusTts.textContent = 'Generating audio...';
            apiStatusTts.classList.remove('hidden');
            ttsAudio.classList.add('hidden');
            ttsBtn.disabled = true;

            const selectedVoice = voiceSelect.value;
            const payload = {
                contents: [{ parts: [{ text: textToSpeak }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: selectedVoice }
                        }
                    }
                },
            };

            let retries = 0;
            while (retries < MAX_RETRIES) {
                try {
                    const response = await fetch(TTS_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const audioPart = result?.candidates?.[0]?.content?.parts?.[0]?.inlineData;
                    if (audioPart) {
                        const audioData = audioPart.data;
                        const mimeType = audioPart.mimeType;
                        const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        ttsAudio.src = audioUrl;
                        ttsAudio.classList.remove('hidden');
                        ttsAudio.play();
                    } else {
                        console.error('TTS API response was not as expected:', result);
                    }
                    apiStatusTts.classList.add('hidden');
                    ttsBtn.disabled = false;
                    return;
                } catch (error) {
                    console.error('Error generating TTS:', error);
                    retries++;
                    if (retries < MAX_RETRIES) {
                        await new Promise(res => setTimeout(res, RETRY_DELAY * Math.pow(2, retries - 1)));
                    } else {
                        apiStatusTts.textContent = 'Failed to generate audio. Please try again.';
                        ttsBtn.disabled = false;
                    }
                }
            }
        }

        ttsBtn.addEventListener('click', generateTTS);
        
        // --- User name and ID logic ---
        const userNameDisplay = document.getElementById('userNameDisplay');
        const userIdPlaceholder = document.getElementById('userId');

        // Load progress and user info on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set dummy user name
            // In a real application, this would be set from your backend upon login.
            const userName = "student"; 
            userNameDisplay.textContent = userName;

            // Load module progress
            const savedProgress = localStorage.getItem('courseProgress');
            if (savedProgress) {
                currentModule = parseInt(savedProgress);
            }
            updateModuleDisplay();
            updateProgressBar();

            // Set dummy user ID
            const dummyUserId = 'user_' + Math.random().toString(36).substring(2, 15);
            userIdPlaceholder.textContent = dummyUserId;
        });
    </script>
</body>
</html>
