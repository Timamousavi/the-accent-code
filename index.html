<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Accent Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Source+Sans+3:wght@400;600&display=swap');
        body {
            font-family: 'Source Sans 3', sans-serif;
            background-color: #0A0A0A;
            background-image: url('https://i.ibb.co/bjgy2Z0F/KDream-Cast-EP02-ALI-MOBINI-You-Tube-Thumbnail-4.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: #F0F0F0;
        }
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
        }
        .bg-custom-gradient {
            background: linear-gradient(145deg, #1A1A1A, #0a2540);
        }
        .text-accent {
            color: #00A9A5; /* A vibrant teal for a premium feel */
        }
        .bg-accent {
            background-color: #00A9A5;
        }
        .border-custom {
            border-color: #333;
        }
        .shadow-custom {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
        }
        .hover\:bg-teal-400:hover {
            background-color: #008f8a;
        }
        .neural-connection {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            opacity: 0.1;
            z-index: 0;
        }
        .neural-connection .dot {
            position: absolute;
            background-color: #00A9A5;
            border-radius: 50%;
            animation: dot-flow 15s infinite linear;
            box-shadow: 0 0 15px #00A9A5;
        }
        @keyframes dot-flow {
            from {
                transform: translateX(0);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            to {
                transform: translateX(100vw);
                opacity: 0;
            }
        }
        /* Custom CSS for card animations */
        .card-hidden {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .card-visible {
            opacity: 1;
            transform: translateY(0);
        }
        /* Hover effects */
        .card-hover-effect {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .card-hover-effect:hover {
            transform: translateY(-8px) rotate(1deg) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.7), 0 10px 10px -5px rgba(0, 0, 0, 0.5);
        }
        /* Button glow animation */
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 5px #00A9A5; }
            50% { box-shadow: 0 0 20px #00A9A5, 0 0 30px #00A9A5; }
            100% { box-shadow: 0 0 5px #00A9A5; }
        }
        .button-glow {
            animation: pulse-glow 2s infinite;
        }
    </style>
</head>
<body class="antialiased">
    <div class="neural-connection">
        <div class="dot w-2 h-2 top-1/4" style="animation-delay: 0s;"></div>
        <div class="dot w-3 h-3 top-1/2 left-1/4" style="animation-delay: 3s;"></div>
        <div class="dot w-1 h-1 top-3/4 right-1/3" style="animation-delay: 6s;"></div>
        <div class="dot w-4 h-4 top-1/4 right-1/4" style="animation-delay: 9s;"></div>
        <div class="dot w-2 h-2 bottom-1/4 left-1/2" style="animation-delay: 12s;"></div>
    </div>

    <header class="max-w-6xl mx-auto px-6 py-8 flex items-center justify-end relative z-10">
        <nav class="flex items-center gap-4">
            <a href="#resources" class="text-sm font-medium hover:text-accent transition-colors duration-200">Free Resources</a>
            <a href="#curriculum" class="text-sm font-medium hover:text-accent transition-colors duration-200">Curriculum</a>
            <a href="#testimonials" class="text-sm font-medium hover:text-accent transition-colors duration-200">Reviews</a>
            <a href="#pricing" class="rounded-md px-4 py-2 bg-accent text-slate-900 text-sm font-bold hover:bg-teal-400 transition-colors duration-200 button-glow">Get started</a>
        </nav>
    </header>

    <main class="max-w-6xl mx-auto px-6 relative z-10">
        <section id="promise" class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center py-20">
            <div>
                <h2 class="text-3xl md:text-4xl font-semibold leading-tight tracking-tight">Stop Hiding. Start Speaking. Gain confident control over your <span class="text-accent">American English</span> pronunciation.</h2>
                <p class="mt-6 text-lg text-slate-300">Unlock your true voice in just 8 weeks. Our scientifically-backed program doesn't just teach; it retrains your brain and muscles to speak with the clarity and rhythm you've always wanted. Get measurable results and the confidence to own every conversation.</p>
                <div class="mt-8 flex flex-wrap gap-4">
                    <a href="#pricing" class="px-6 py-3 bg-accent text-slate-900 rounded-lg font-extrabold hover:bg-teal-400 transition-colors duration-200 shadow-custom text-lg button-glow">Start Your Transformation Today</a>
                    <a href="#curriculum" class="px-6 py-3 border border-custom rounded-lg font-medium hover:bg-slate-800 transition-colors duration-200">Explore the Full Curriculum &rarr;</a>
                </div>
            </div>
            <div class="bg-custom-gradient p-8 rounded-xl shadow-custom card-hidden card-hover-effect">
                <h3 class="text-2xl font-bold text-accent">Unlock Your Free Mini-Lesson.</h3>
                <p class="text-slate-400 mt-2">Get an instant assessment and a 10-minute training drill. No commitment, just pure value.</p>
                <form class="mt-6 grid gap-4">
                    <input class="w-full bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Your Full Name" />
                    <input class="w-full bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Your Email Address" />
                    <button onclick="getAICoachResponse()" class="w-full rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200 text-lg">Send My Free Lesson</button>
                </form>
            </div>
        </section>

        <section id="curriculum" class="py-12">
            <h3 class="text-3xl font-bold">The 8-Week Transformation: Your Path to Fluency</h3>
            <p class="text-slate-400 mt-4">We've broken down the complex science of accent mastery into a simple, step-by-step roadmap that works.</p>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Module 1 -->
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom card-hidden card-hover-effect">
                    <div class="text-sm font-semibold text-accent">Module 1 • Week 1</div>
                    <div class="mt-2 text-xl font-bold">Foundation & Mindset</div>
                    <p class="mt-3 text-slate-400">
                        Stop believing you can't change. We'll show you the science of brain plasticity and give you a clear path to success.
                    </p>
                </div>
                <!-- Module 2 -->
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom card-hidden card-hover-effect">
                    <div class="text-sm font-semibold text-accent">Module 2 • Weeks 2-3</div>
                    <div class="mt-2 text-xl font-bold">Mastering Core Sounds</div>
                    <p class="mt-3 text-slate-400">
                        Learn the phonetic secrets of American English. You'll master key vowels and consonants that make the biggest difference in how you're understood.
                    </p>
                </div>
                <!-- Module 3 -->
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom card-hidden card-hover-effect">
                    <div class="text-sm font-semibold text-accent">Module 3 • Week 4</div>
                    <div class="mt-2 text-xl font-bold">The Music of English</div>
                    <p class="mt-3 text-slate-400">
                        Go beyond individual sounds. You'll learn to speak with natural rhythm, intonation, and stress, so you sound authentic and confident.
                    </p>
                </div>
                <!-- Module 4 -->
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom card-hidden card-hover-effect">
                    <div class="text-sm font-semibold text-accent">Module 4 • Week 5</div>
                    <div class="mt-2 text-xl font-bold">Seamless Connected Speech</div>
                    <p class="mt-3 text-slate-400">
                        Discover the "shortcuts" native speakers use. This module teaches you to link words smoothly, making your speech flow naturally and effortlessly.
                    </p>
                </div>
                <!-- Module 5 -->
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom card-hidden card-hover-effect">
                    <div class="text-sm font-semibold text-accent">Module 5 • Weeks 6-7</div>
                    <div class="mt-2 text-xl font-bold">Active Practice & Refinement</div>
                    <p class="mt-3 text-slate-400">
                        We move from theory to application. Through advanced shadowing and self-analysis, you'll build the muscle memory needed to make your new accent second nature.
                    </p>
                </div>
                <!-- Module 6 -->
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom card-hidden card-hover-effect">
                    <div class="text-sm font-semibold text-accent">Module 6 • Week 8</div>
                    <div class="mt-2 text-xl font-bold">Confidence & Consistency</div>
                    <p class="mt-3 text-slate-400">
                        This is where your new skills become part of you. We'll create a simple, sustainable plan for lifelong improvement, so you can speak with confidence in any situation.
                    </p>
                </div>
            </div>
        </section>

        <section id="ai-tools" class="py-12">
            <h3 class="text-3xl font-bold">Your AI-Powered Tools</h3>
            <p class="text-slate-400 mt-4">Enhance your learning with cutting-edge tools powered by Gemini AI.</p>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- AI Pronunciation Coach -->
                <div class="bg-custom-gradient p-8 rounded-xl shadow-custom flex flex-col h-full card-hidden card-hover-effect">
                    <h4 class="text-2xl font-bold text-accent">AI Pronunciation Coach</h4>
                    <p class="text-slate-400 mt-2 flex-grow">Your personal tutor for instant, accurate answers on phonetics, rhythm, and more. Ask any question about your course material.</p>
                    <div class="mt-6 flex flex-col gap-4">
                        <textarea id="coachInput" class="w-full bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Ask the AI a question about your accent training..."></textarea>
                        <button onclick="getAICoachResponse()" class="w-full rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200">Ask the Coach</button>
                    </div>
                    <div id="coachResponse" class="mt-4 p-4 rounded-md bg-slate-800 text-slate-300 hidden"></div>
                </div>

                <!-- Text-to-Speech Tool -->
                <div class="bg-custom-gradient p-8 rounded-xl shadow-custom flex flex-col h-full card-hidden card-hover-effect">
                    <h4 class="text-2xl font-bold text-accent">Text-to-Speech Tool</h4>
                    <p class="text-slate-400 mt-2 flex-grow">Hear any text pronounced with a native American accent. Choose a voice and practice your listening skills.</p>
                    <div class="mt-6 flex flex-col gap-4">
                        <textarea id="ttsInput" class="w-full bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Type or paste text to hear it..."></textarea>
                        <select id="voiceSelect" class="w-full bg-slate-800 border-custom text-white rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-accent">
                            <option value="Kore">Kore (Firm)</option>
                            <option value="Puck">Puck (Upbeat)</option>
                            <option value="Zephyr">Zephyr (Bright)</option>
                        </select>
                        <button onclick="generateTTSAudio()" class="w-full rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200">Generate Speech</button>
                    </div>
                    <audio id="audioPlayer" controls class="mt-4 hidden"></audio>
                </div>
            </div>
        </section>

        <section id="testimonials" class="py-12">
            <h3 class="text-2xl font-bold">Transform Your Confidence. Hear What Our Students Say.</h3>
            <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-custom-gradient p-6 rounded-xl shadow-custom card-hidden card-hover-effect">
                    <div class="flex items-center gap-4 mb-4">
                        <img src="https://i.ibb.co/ybB9d6F/Gemini-Generated-Image-pafo69pafo69pafo.png" alt="Javier S." class="w-16 h-16 rounded-full object-cover">
                        <div class="font-semibold text-accent">Javier S.</div>
                    </div>
                    <div class="text-slate-300 text-lg italic">"I'm a native Spanish speaker, and after just 6 weeks, my colleagues have noticed a significant improvement in my clarity. The drills are practical and easy to fit into a busy schedule. I'm now much more confident in meetings."</div>
                </div>
                <div class="bg-custom-gradient p-6 rounded-xl shadow-custom card-hidden card-hover-effect">
                    <div class="flex items-center gap-4 mb-4">
                        <img src="https://i.ibb.co/nM8RX4z8/Gemini-Generated-Image-ndakf6ndakf6ndak.png" alt="Li Wei M." class="w-16 h-16 rounded-full object-cover">
                        <div class="font-semibold text-accent">Li Wei M.</div>
                    </div>
                    <div class="text-slate-300 text-lg italic">"This course is a game-changer. It feels like having a personal tutor available 24/7. I used to be hesitant to speak up, but practicing with the course material gave me the confidence to join conversations without fear of mispronunciation."</div>
                </div>
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom card-hidden card-hover-effect">
                    <div class="flex items-center gap-4 mb-4">
                        <img src="https://i.ibb.co/yBWcn7Nc/Gemini-Generated-Image-wp15klwp15klwp15.png" alt="Reneé P." class="w-16 h-16 rounded-full object-cover">
                        <div class="font-semibold text-accent">Reneé P.</div>
                    </div>
                    <div class="text-slate-300 text-lg italic">"This course finally helped me understand the 'music' of English. The lessons on intonation and stress were exactly what I needed. Now, my speech doesn't just sound correct; it sounds natural and fluent."</div>
                </div>
            </div>
        </section>

        <section id="pricing" class="py-12">
            <h3 class="text-2xl font-bold">Pricing</h3>
            <p class="text-slate-400 mt-4">Choose the plan that's right for you and begin your transformation today.</p>
            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-custom-gradient p-8 rounded-xl shadow-custom border border-custom card-hidden card-hover-effect">
                    <div>
                        <div class="text-slate-400 text-lg">The Core Program</div>
                        <div class="mt-2 flex items-baseline gap-2">
                            <span class="text-5xl font-extrabold text-accent">$149</span>
                            <span class="text-3xl line-through text-red-500 font-bold">$300</span>
                        </div>
                        <ul class="mt-6 text-slate-300 space-y-2 list-disc list-inside">
                            <li>Self-paced, 8-week program</li>
                            <li>Includes all 6 modules</li>
                            <li>Lifetime access to all video lessons and resources</li>
                            <li>Guided self-assessment and feedback tools</li>
                        </ul>
                    </div>
                    <a href="#" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200 text-lg">Enroll Now</a>
                </div>
                <div class="bg-custom-gradient p-8 rounded-xl shadow-custom border border-custom flex flex-col justify-between card-hidden card-hover-effect">
                    <div>
                        <div class="text-slate-400 text-lg">The Elite Program</div>
                        <div class="mt-2 flex items-baseline gap-2">
                            <span class="text-5xl font-extrabold text-accent">$399</span>
                            <span class="text-3xl line-through text-red-500 font-bold">$700</span>
                        </div>
                        <ul class="mt-6 text-slate-300 space-y-2 list-disc list-inside">
                            <li>Everything in the self-paced course, plus:</li>
                            <li>4x 30-minute one-on-one coaching calls</li>
                            <li>Personalized feedback on your diagnostic recordings</li>
                            <li>Custom practice plans to target your specific challenges</li>
                        </ul>
                    </div>
                    <a href="#" class="mt-8 w-full block text-center rounded-md px-4 py-3 bg-accent text-slate-900 font-extrabold hover:bg-teal-400 transition-colors duration-200 text-lg">Enroll with Coaching</a>
                </div>
            </div>
        </section>

        <section id="resources" class="py-12">
            <h3 class="text-2xl font-bold">Free Resources</h3>
            <p class="text-slate-400 mt-4">Short drills, downloadable cheat sheets, and a mini assessment to get you started.</p>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Video Guide -->
                <div class="bg-custom-gradient rounded-xl p-6 shadow-custom border border-custom card-hidden card-hover-effect">
                    <div class="font-semibold text-lg text-accent">13-Minute American Accent Guide</div>
                    <p class="text-slate-400 text-sm mt-1">Watch this video to discover the key principles of a clear American accent.</p>
                    <div class="mt-4">
                        <iframe width="100%" height="auto" src="https://www.youtube.com/embed/D_ENs89iB8g" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg shadow-custom"></iframe>
                    </div>
                </div>
                <!-- Pronunciation Cheat Sheet -->
                <div class="bg-custom-gradient rounded-lg p-6 shadow-custom border border-custom card-hidden card-hover-effect">
                    <div class="font-semibold text-lg text-accent">The American English IPA Chart </div>
                    <div class="text-slate-400 text-sm mt-1">Your Key to Pronouncing Sounds with Percision.</div>
                    <div class="mt-4">
                        <img src="https://i.ibb.co/xKNN5R9p/Capture1.png" class="rounded-lg shadow-custom" />
                    </div>
                </div>
                <!-- Conversation Scripts -->
                <div class="bg-custom-gradient rounded-lg p-6 shadow-custom border border-custom card-hidden card-hover-effect">
                    <div class="font-semibold text-lg text-accent">Shadowing Drill Videos</div>
                    <div class="text-slate-400 text-sm mt-1">Use these to practice real-world conversations.</div>
                    <div class="mt-4">
                        <iframe width="100%" height="auto" src="https://www.youtube.com/embed/1PlcxuRh18g" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="rounded-lg shadow-custom"></iframe>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="mt-20 border-t border-slate-700 bg-slate-900 py-8">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between gap-4 text-slate-400">
            <div>
                <div class="font-bold text-white">The Accent Code</div>
                <div class="text-sm mt-1">Made with love by Tima Mousavi &copy; 2025 ❤️</div>
            </div>
            <div class="text-sm">Follow us on social media
                <div class="mt-2 flex gap-4">
                    <a href="https://youtube.com/Tima_mousavi" class="hover:text-accent transition-colors duration-200">YouTube</a>
                    <a href="https://instagram.com/theaccentcode" class="hover:text-accent transition-colors duration-200">Instagram</a>
                    <a href="https://t.me/theaccentcode" class="hover:text-accent transition-colors duration-200">Telegram</a>
                    <a href="mailto:theaccentcode@outlook.com" class="hover:text-accent transition-colors duration-200">Email</a>
                </div>
            </div>
        </div>
    </footer>
    <script>
        const apiKey = typeof __gemini_api_key__ !== 'undefined' ? __gemini_api_key__ : '';
        
        // Helper function to decode base64 and create a WAV blob
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcmData, sampleRate) {
            const dataLength = pcmData.length * 2;
            const buffer = new ArrayBuffer(44 + dataLength);
            const view = new DataView(buffer);
            
            // RIFF chunk descriptor
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataLength, true);
            writeString(view, 8, 'WAVE');
            
            // fmt sub-chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); // Subchunk1Size
            view.setUint16(20, 1, true); // AudioFormat (1=PCM)
            view.setUint16(22, 1, true); // NumChannels
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true); // ByteRate
            view.setUint16(32, 2, true); // BlockAlign
            view.setUint16(34, 16, true); // BitsPerSample
            
            // data sub-chunk
            writeString(view, 36, 'data');
            view.setUint32(40, dataLength, true);
            
            // Write PCM data
            for (let i = 0; i < pcmData.length; i++) {
                view.setInt16(44 + i * 2, pcmData[i], true);
            }
            
            return new Blob([view], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }
        
        // --- AI Pronunciation Coach Logic ---
        async function getAICoachResponse() {
            const userInput = document.getElementById('coachInput').value;
            const responseDiv = document.getElementById('coachResponse');
            if (!userInput) {
                return;
            }

            responseDiv.style.display = 'block';
            responseDiv.innerHTML = 'Thinking...';

            const systemPrompt = "You are an expert American English pronunciation coach. Provide clear, concise, and helpful advice to a student learning the American accent. Use simple language and encouraging tone. Focus on practical tips and phonetic explanations.";
            
            const payload = {
                contents: [{ parts: [{ text: userInput }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                tools: [{ "google_search": {} }],
            };

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate a response. Please try again.";
                responseDiv.innerHTML = text;

            } catch (error) {
                console.error('Error fetching AI response:', error);
                responseDiv.innerHTML = 'An error occurred. Please try again later.';
            }
        }

        // --- TTS Tool Logic ---
        async function generateTTSAudio() {
            const textInput = document.getElementById('ttsInput').value;
            const voiceName = document.getElementById('voiceSelect').value;
            const audioPlayer = document.getElementById('audioPlayer');

            if (!textInput) {
                return;
            }

            const payload = {
                contents: [{
                    parts: [{ text: `Say this phrase in a clear, standard American accent: "${textInput}"` }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: voiceName }
                        }
                    }
                },
            };

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            audioPlayer.style.display = 'none';
            audioPlayer.pause();
            audioPlayer.removeAttribute('src');

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    if (!sampleRateMatch) {
                        throw new Error('Could not determine sample rate from MIME type.');
                    }
                    const sampleRate = parseInt(sampleRateMatch[1], 10);
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    audioPlayer.src = audioUrl;
                    audioPlayer.style.display = 'block';
                } else {
                    // Replaced alert with a custom message box
                    const messageBox = document.createElement('div');
                    messageBox.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50';
                    messageBox.innerHTML = `
                        <div class="bg-gray-800 p-6 rounded-lg text-white text-center shadow-lg">
                            <p>An error occurred. The audio could not be generated.</p>
                            <button onclick="this.parentElement.parentElement.remove()" class="mt-4 px-4 py-2 bg-accent text-slate-900 rounded-md">OK</button>
                        </div>
                    `;
                    document.body.appendChild(messageBox);
                }
            } catch (error) {
                console.error('Error fetching TTS audio:', error);
                // Replaced alert with a custom message box
                const messageBox = document.createElement('div');
                messageBox.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50';
                messageBox.innerHTML = `
                    <div class="bg-gray-800 p-6 rounded-lg text-white text-center shadow-lg">
                        <p>An error occurred. Please try again later.</p>
                        <button onclick="this.parentElement.parentElement.remove()" class="mt-4 px-4 py-2 bg-accent text-slate-900 rounded-md">OK</button>
                    </div>
                `;
                document.body.appendChild(messageBox);
            }
        }
        
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const observerOptions = {
                root: null,
                rootMargin: "0px",
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('card-visible');
                        entry.target.classList.remove('card-hidden');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.card-hidden').forEach(card => {
                observer.observe(card);
            });
        });
    </script>
</body>
</html>
